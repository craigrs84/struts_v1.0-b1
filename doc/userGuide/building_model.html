<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/WD-html-in-xml/DTD/xhtml1-strict.dtd">
<html><head><meta name="author" content="Craig R. McClanahan"><title>The Struts User's Guide - Building Model Components</title></head><body bgcolor="#ffffff" text="#000000" link="#023264" alink="#023264" vlink="#023264"><table border="0" width="100%" cellspacing="5"><tr><td colspan="2"><a href="http://jakarta.apache.org"><img src="../images/jakarta-logo.gif" align="left" border="0"></a><img src="../images/struts.gif" align="right" border="0"></td></tr><tr><td colspan="2"><hr></td></tr><tr><td width="120" valign="top"><project href="http://jakarta.apache.org/struts/userGuide" image="../images/struts.gif" name="Struts User's Guide">      <title>Struts User's Guide</title>      <table border="0" cellspacing="5"><tr><th colspan="2" align="left"><font color><strong>Quick Links</strong></font></th></tr>       <tr><td align="center" width="15"></td><td><font size="-1"><a href="../index.html">Home</a></font></td></tr>       <tr><td align="center" width="15"></td><td><font size="-1"><a href="index.html">Table of Contents</a></font></td></tr>       <tr><td align="center" width="15"></td><td><font size="-1"><a href="introduction.html">Introduction</a></font></td></tr>       <tr><td align="center" width="15"></td><td><font size="-1"><a href="building_model.html">Model Components</a></font></td></tr>       <tr><td align="center" width="15"></td><td><font size="-1"><a href="building_view.html">View Components</a></font></td></tr>       <tr><td align="center" width="15"></td><td><font size="-1"><a href="building_controller.html">Controller Components</a></font></td></tr>       <tr><td align="center" width="15"></td><td><font size="-1"><a href="resources.html">Resources</a></font></td></tr>     </table>  </project></td><td valign="top"><body>     <a name="building_model"></a><table border="0" cellspacing="5" cellpadding="5" width="100%"><tr><td bgcolor="#023264"><font color="#ffffff" face="arial,helvetica,sanserif" size="+1"><strong>2. Building Model Components</strong></font></td></tr></table><a name="overview"></a><table border="0" cellspacing="5" cellpadding="5" width="100%"><tr><td bgcolor="#023264"><font color="#ffffff" face="arial,helvetica,sanserif" size="+1"><strong>2.1 Overview</strong></font></td></tr><tr><td><blockquote>                  <p>           The application requirements document that you are using will likely         have focused on the user interface to be created.  However, you should ensure         that the processing required for each submitted request is also clearly         defined.  In general, the developer of the <i>Model</i> components will be         focusing on the creation of JavaBeans classes that support all of the         functional requirements.  The precise nature of the beans required by a         particular application will vary widely depending on those requirements,         but they can generally be classified into several categories discussed         below.  However, a brief review of the concept of &quot;scope&quot; as it relates         to beans is useful first.       </p>     </blockquote></td></tr></table><a name="javabeans"></a><table border="0" cellspacing="5" cellpadding="5" width="100%"><tr><td bgcolor="#023264"><font color="#ffffff" face="arial,helvetica,sanserif" size="+1"><strong>2.2 JavaBeans and Scope</strong></font></td></tr><tr><td><blockquote>            <p>         Within a web-based application, JavaBeans can be stored in (and accessed         from) a number of different collections of &quot;attributes&quot;.  Each collection         has different rules for the lifetime of that collection, and the visibility         of the beans stored there.  Together, the rules defining lifetime and         visibility are called the <i>scope</i> of those beans.  The JavaServer         Pages (JSP) Specification defines scope choices using the following terms         (with the equivalent servlet API concept defined in parentheses):       </p>                <ul>         <li><b>page</b> - Beans that are visible within a single JSP page,             for the lifetime of the current request.  (Local variables of             the <code>service()</code> method)         <li><b>request</b> - Beans that are visible within a single JSP page,             as well as to any page or servlet that is included in this page,             or forwarded to by this page.  (Request attributes)         <li><b>session</b> - Beans that are visible to all JSP pages and             servlets that participate in a particular user session, across one             or more requests.  (Session attributes)         <li><b>application</b> - Beans that are visible to all JSP pages and             servlets that are part of a web application.  (Servlet context             attributes)       </ul>                <p>         It is important to remember that JSP pages and servlets in the same         web application share the same sets of bean collections.  For example,         a bean stored as a request attribute in a servlet like this:       </p>                <p><code>MyCart mycart = new MyCart(...);<br>         request.setAttribute(&quot;cart&quot;, mycart);       </code></p>              <p>         is immediately visible to a JSP page which this servlet forwards to,         using a standard action tag like this:       </p>                <p><code>&lt;jsp:useBean id=&quot;cart&quot; scope=&quot;request&quot;<br>         class=&quot;com.mycompany.MyApp.MyCart&quot;/&gt;       </code></p>     </blockquote></td></tr></table><a name="actionform"></a><table border="0" cellspacing="5" cellpadding="5" width="100%"><tr><td bgcolor="#023264"><font color="#ffffff" face="arial,helvetica,sanserif" size="+1"><strong>2.3 ActionForm Beans</strong></font></td></tr><tr><td><blockquote>              <p>         Note: ActionForm beans are actually closer to the <i>View</i>         than the <i>Model</i>.       </p>       <p>         The Struts framework generally assumes that you have created an         <code>ActionForm</code> bean (that is, a Java class extending the         <code>ActionForm</code> class) for each input form required in your         application.  If you define such beans in your <code>ActionMapping</code>         configuration file (see &quot;<a href="building_controller.html#config">         Building the Controller Components</a>&quot;), the Struts  controller servlet          will automatically perform the following services for you, before          invoking the appropriate <code>Action</code> method:       </p>                <ul>         <li>Check in the user's session for an instance of a bean of the             appropriate class, under the appropriate key.         <li>If there is no such session scope bean available, a new one is             automatically created and added to the user's session.         <li>For every request parameter whose name corresponds to the name             of a property in the bean, the corresponding setter method will             be called.  This operates in a manner similar to the standard             JSP action <code>&lt;jsp:setProperty&gt;</code> when you use the             asterisk wildcard to select all properties.         <li>The updated <code>ActionForm</code> bean will be passed to the             Action Class <code>perform()</code> method when it is called,             making these values immediately available.       </ul>                <p>         When you code your <code>ActionForm</code> beans, keep the following         principles in mind:       </p>              <ul>         <li>The <code>ActionForm</code> class itself requires no specific             methods to be implemented.  It is used to identify the role these             particular beans play in the overall architecture.  Typically, an             <code>ActionForm</code> bean will have only property getter and             property setter methods, with no business logic.                        <li>The ActionForm object also offers a standard validation mechanism.              If you override a &quot;stub&quot; method, and provide error messages in the              standard application resource, Struts will automatically validate the              input from the form (using your method). See &quot;<a href="./building_view.html#form_validation">Action Form Validation</a>&quot;              for details. Of course, you can also ignore the ActionForm validation              and provide your own in the Action object.                     <li>Define a property (with associated <code>getXxx()</code> and             <code>setXxx()</code> methods) for each field that is present             in the form.  The field name and property name must match according             to the usual JavaBeans conventions.  For example, an input field named             <code>username</code> will cause the <code>setUsername()</code> method             to be called.         <li>You may also place a bean instance on your form, and use nested property              references. For example, you might have a &quot;customer&quot; bean on your Action              Form, and then refer to the property &quot;customer.name&quot; in your JSP view.              This would correspond to the methods <code>customer.getName()</code> and              <code>customer.setName(string Name)</code> on your customer bean. See the              Tag Library Developer Guides for more about nested syntax.       </ul>                <p>         You should note that a &quot;form&quot;, in the sense discussed here, does not         necessarily correspond to a single JSP page in the user interface.  It is         common in many applications to have a &quot;form&quot; (from the user's perspective)         that extends over multiple pages.  Think, for example, of the wizard style         user interface that is commonly used when installing new applications.  Struts         encourages you to define a single <code>ActionForm</code> bean that contains         properties for all of the fields, no matter which page the field is actually         displayed on.  Likewise, the various pages of the same form should all be         submitted to the same Action Class.  If you follow these suggestions, the         page designers can rearrange the fields among the various pages, pftem without          requiring changes to the processing logic.       </p>     </blockquote></td></tr></table><a name="system_state"></a><table border="0" cellspacing="5" cellpadding="5" width="100%"><tr><td bgcolor="#023264"><font color="#ffffff" face="arial,helvetica,sanserif" size="+1"><strong>2.4 System State Beans</strong></font></td></tr><tr><td><blockquote>              <p>         The actual state of a system is normally represented as a set of one or         more JavaBeans classes, whose properties define the current state.  A         shopping cart system, for example, will include a bean that represents the         cart being maintained for each individual shopper, and will (among other         things) include the set of items that the shopper has currently selected         for purchase.  Separately, the system will also include different beans         for the user's profile information (including their credit card and ship-to         addresses), as well as the catalog of available items and their current         inventory levels.       </p>                <p>         For small scale systems, or for state information that need not be kept         for a long period of time, a set of system state beans may contain all the         knowledge that the system ever has of these particular details.  Or, as is         often the case, the system state beans will represent information that is         stored permanently in some external database (such as a <code>CustomerBean</code> object         that corresponds to a particular row in the CUSTOMERS table), and are         created or removed from the server's memory as needed.  Entity Enterprise         JavaBeans are also used for this purpose in large scale applications.       </p>     </blockquote></td></tr></table><a name="business_logic"></a><table border="0" cellspacing="5" cellpadding="5" width="100%"><tr><td bgcolor="#023264"><font color="#ffffff" face="arial,helvetica,sanserif" size="+1"><strong>2.5 Business Logic Beans</strong></font></td></tr><tr><td><blockquote>              <p>         You should encapsulate the functional logic of your application as         method calls on JavaBeans designed for this purpose.  These methods may         be part of the same classes used for the system state beans, or they may         be in separate classes dedicated to performing the logic.  In the latter         case, you will usually need to pass the system state beans to be manipulated         to these methods as arguments.       </p>                <p>         For maximum code re-use, business logic beans should be designed and         implemented so that they do <b>not</b> know they are being executed in a         web application environment.  If you find yourself having to import a         <code>javax.servlet.*</code> class in your bean, you         are tying this business logic to the web application environment.  Consider         rearranging things so that your <code>Action</code> classes (part of the         Controller role, as described below) translate all required information         from the HTTP request being processed into property setter calls on your         business logic beans, after which a call to an <code>execute()</code> method         can be made.  Such a business logic class can be reused in environments         other than the web application for which they were initially constructed.       </p>                <p>         Depending on the complexity and scope of your application, business logic         beans might be ordinary JavaBeans that interact with system state beans         passed as arguments, or ordinary JavaBeans that access a database using         JDBC calls.  For larger applications, these beans will often be stateful         or stateless Enterprise JavaBeans (EJBs) instead.       </p>     </blockquote></td></tr></table><a name="databases"></a><table border="0" cellspacing="5" cellpadding="5" width="100%"><tr><td bgcolor="#023264"><font color="#ffffff" face="arial,helvetica,sanserif" size="+1"><strong>2.6 Accessing Relational Databases</strong></font></td></tr><tr><td><blockquote>              <p>         Struts can define the datasources for an application from within its standard          configuration file. A simple JDBC connection pool is also provided. See <a href="building_controller.html#config">The Action Mappings Configuration File</a>         section and the Utilities Developer Guide for details.        </p>       <p>         After the datasource is defined, here is an example of establishing a connection          from within a Action perform method.       </p> <pre>
public ActionForward
       perform(ActionMapping mapping,
               ActionForm form,
               HttpServletRequest request,
               HttpServletResponse response)
{
 try {
   javax.sql.DataSource dataSource =
     servlet.findDataSource(null);
   java.sql.Connection myConnection =
     dataSource.getConnection();

   //do what you wish with myConnection
 } catch (SQLException sqle) {
   getServlet().log(&quot;Connection.process&quot;, sqle);
 } finally {

   //enclose this in a finally block to make
   //sure the connection is closed
   try {
     myConnection.close();
   } catch (SQLException e) {
     getServlet().log(&quot;Connection.close&quot;, e);
   }
 }
}
</pre>              <p align="center">         Next: <a href="building_view.html">Building View Components</a>       </p>     </blockquote></td></tr></table>   </body></td></tr><tr><td colspan="2"><hr></td></tr><tr><td colspan="2"><div align="center"><font color="#023264" size="-1"><em>         Copyright (c) 2000-2001, Apache Software Foundation         </em></font></div><img src="../images/struts-power.gif" align="right" border="0"></td></tr></table></body></html>